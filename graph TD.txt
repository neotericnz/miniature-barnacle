graph TD
    %% Networking Components
    AKS[Immuta Application (AKS)]
    PostgreSQL[Metadata Database (PostgreSQL)]
    Elasticsearch[Elasticsearch (ISV)]
    Blob[Blob Storage]
    NSGs[Network Security Groups]

    %% Security Components
    AAD[Azure AD]
    KeyVault[Azure Key Vault]
    WAF[App Gateway with WAF]

    %% Monitoring Components
    Monitor[Azure Monitor]
    Defender[Microsoft Defender]

    %% Snowflake and Users
    Snowflake[Snowflake]
    DataConsumers[Data Consumers]
    ImmutaAdmins[Immuta Admins]

    %% Connections
    AAD --> ImmutaAdmins : "Authenticates"
    AAD --> DataConsumers : "Authenticates"
    ImmutaAdmins --> AKS : "Manage Policies"

    AAD --> AKS : "Authenticates"
    KeyVault --> AKS : "Secures Secrets"
    WAF --> AKS : "Routes Secure Traffic"

    AKS --> PostgreSQL : "Policy Queries"
    AKS --> Elasticsearch : "Metadata Indexing"
    AKS --> Blob : "Stores Configurations"
    AKS --> Snowflake : "Applies Policies"
    Snowflake --> DataConsumers : "Access Datasets"

    Monitor --> AKS : "Collects Logs"
    Monitor --> Defender : "Analyzes Threats"
    NSGs --> Blob : "Restricts Traffic"
    NSGs --> Snowflake : "Restricts Access"
